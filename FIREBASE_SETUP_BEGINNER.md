# 🔥 Firebase セットアップガイド（初心者向け）

このガイドでは、初めて Firebase を使う方でも、画像を見ながら設定できるように詳しく説明します。

---

## 📝 事前準備

- Google アカウントを持っていること（Gmail アカウントで OK）

---

## ステップ 1: Firebase Console にアクセス

1. ブラウザで [https://console.firebase.google.com/](https://console.firebase.google.com/) を開く
2. 右上の「Google アカウントでログイン」をクリック
3. 自分の Google アカウントでログイン

---

## ステップ 2: プロジェクトを作成

### 2-1. プロジェクト追加

1. 画面左側に「プロジェクトを追加」というボタンがあるので、それをクリック
2. または、画面中央の「プロジェクトを追加」をクリック

### 2-2. プロジェクト名を入力

1. 「プロジェクト名」に適当な名前を入力（例：`talkfridge`）
2. 「続行」をクリック

### 2-3. Google Analytics（オプション）

1. 「Google Analytics を有効にする」は**オフにしても OK**（この機能では使わないので）
2. そのまま「プロジェクトを作成」をクリック

### 2-4. 待機

1. 「プロジェクトの準備ができています」と表示されるまで待つ（30 秒〜1 分くらい）
2. 「続行」をクリック

---

## ステップ 3: Web アプリを追加

### 3-1. Web アプリの追加画面を開く

1. プロジェクトのホーム画面が表示されたら、画面上部の**⚙️（歯車）アイコン**をクリック
2. メニューが開いたら「プロジェクトの設定」をクリック
3. 下にスクロールして「マイアプリ」というセクションを見つける
4. 3 つのアイコン（</>、iOS、Android）の中から、**</>（Web）アイコン**をクリック

### 3-2. アプリの登録

1. 「アプリのニックネーム」に適当な名前を入力（例：`TalkFridge Web`）
2. 「このアプリの Firebase Hosting も設定しますか？」は**チェックを外す**（使わないので）
3. 「アプリを登録」をクリック

### 3-3. 設定情報をコピー

1. 黒い画面にコードが表示されます。以下のような形式です：

```javascript
const firebaseConfig = {
  apiKey: "AIzaSy...",
  authDomain: "your-project.firebaseapp.com",
  projectId: "your-project-id",
  storageBucket: "your-project.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abc123",
};
```

2. **このコード全体をコピー**してください（Ctrl+C または Cmd+C）
3. **重要：この画面は後で見るのが大変なので、コピーした内容をメモ帳などに保存しておいてください！**

---

## ステップ 4: Firebase 設定ファイルに貼り付け

### 4-1. ファイルを開く

1. `food_reminder_app/public/firebase-config.js` というファイルを開く
2. エディタ（Cursor、VS Code、テキストエディタなど）で開いてください

### 4-2. 設定を貼り付け

1. ファイルの中身を全部消す
2. 先ほどコピーしたコードを貼り付ける（Ctrl+V または Cmd+V）
3. 一番上の `const firebaseConfig = {` を `const FIREBASE_CONFIG = {` に変更（大文字に）
4. ファイルを保存（Ctrl+S または Cmd+S）

**完成形の例：**

```javascript
const FIREBASE_CONFIG = {
  apiKey: "AIzaSy...",
  authDomain: "your-project.firebaseapp.com",
  projectId: "your-project-id",
  storageBucket: "your-project.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abc123",
};
```

---

## ステップ 5: Authentication（認証）を設定

### 5-1. Authentication 画面を開く

1. Firebase Console の画面左側のメニューを確認
2. 「Authentication」をクリック（人形のアイコン）
3. 「始める」というボタンが表示されたら、それをクリック

### 5-2. Google ログインを有効化

1. 「Sign-in method」（サインイン方法）というタブをクリック
2. 一覧の中から「Google」を探してクリック
3. 「有効にする」というスイッチを**ON にする**
4. 「プロジェクトのサポートメール」は自動で設定されているので、そのまま
5. 「保存」をクリック

### 5-3. 認証済みドメインを追加（重要！）

**この設定をしないと、ログインボタンを押してもエラーになります！**

1. Authentication 画面の「設定」タブを開く
2. 下にスクロールして「承認済みドメイン」セクションを探す
3. 以下のドメインを追加：
   - **`localhost`** （ローカル開発用）
   - **`127.0.0.1`** （ローカル開発用、念のため）
   - **Vercel の URL**（デプロイ後、例：`your-app.vercel.app`）
4. ドメインを追加する方法：
   - 「ドメインを追加」ボタンをクリック
   - ドメイン名を入力（例：`localhost`）
   - 「追加」をクリック

**注意：**

- `localhost` と `127.0.0.1` はローカル開発で必須です
- デプロイ後は、Vercel の URL も追加してください

---

## ステップ 6: Firestore（データベース）を設定

### 6-1. Firestore 画面を開く

1. Firebase Console の画面左側のメニューで「Firestore Database」をクリック
2. 「データベースを作成」というボタンをクリック

### 6-2. データベースを作成

1. **「本番環境モードで開始」を選択**（「テストモードで開始」ではない）
2. 「次へ」をクリック
3. 「ロケーション」を選択（日本の場合、`asia-northeast1` (Tokyo) を選ぶと早いです）
4. 「有効にする」をクリック
5. **⚠️ エラーが出る場合：**
   - 「請求（billing）を有効にする必要があります」というエラーが出たら
   - → 下の「🚨 よくあるエラーと解決方法 > エラー 4」を参照
   - → または `FIREBASE_BILLING_SETUP.md` ファイルを開いて詳細を確認
6. 作成中なので、少し待ちます（1〜2 分）

### 6-3. セキュリティルールを設定（重要！）

1. Firestore Database の画面で「ルール」というタブをクリック
2. コードが表示されているので、全部消して以下のコードを貼り付け：

```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

3. 「公開」というボタンをクリック
4. 「公開しますか？」と聞かれたら「公開」をクリック

---

## ステップ 7: 動作確認

### 7-1. アプリを開く

1. Vercel にデプロイしたアプリを開く（またはローカルサーバーを起動）
2. 「食べた歴史」タブをクリック

### 7-2. ログインしてみる

1. 「🔐 Google アカウントでログイン」というボタンがあるので、クリック
2. Google のログイン画面が出てきたら、自分のアカウントを選ぶ
3. 「TalkFridge にアクセスすることを許可しますか？」と聞かれたら「許可」をクリック
4. 元のアプリに戻ると「ログイン中: [あなたのメールアドレス]」と表示されていれば成功！

### 7-3. データ保存を確認

1. 食材を 1 つ追加してみる
2. Firebase Console に戻る
3. 左メニューから「Firestore Database」をクリック
4. 「users」というコレクション（フォルダ）が表示される
5. それをクリックすると、あなたのデータが表示されているはずです

---

## ✅ チェックリスト

設定が完了したか確認しましょう：

- [ ] Firebase Console でプロジェクトを作成した
- [ ] Web アプリを追加して設定情報をコピーした
- [ ] `firebase-config.js` に設定を貼り付けた
- [ ] Authentication で Google ログインを有効にした
- [ ] Firestore Database を作成した
- [ ] セキュリティルールを設定した
- [ ] アプリでログインできた
- [ ] 食材を追加して Firebase に保存されることを確認した

---

## 🚨 よくあるエラーと解決方法

### ❌ エラー 1: 「Firebase SDK が読み込まれていません」

**解決方法：**

- アプリを再読み込み（F5 またはページ更新）してみてください
- ブラウザのコンソール（F12 > Console）でエラーを確認

### ❌ エラー 2: 「Firebase 設定がまだです」

**解決方法：**

- `firebase-config.js` を確認してください
- `YOUR_API_KEY` などの文字列が残っていないか確認
- Firebase Console からコピーした設定が正しく貼り付けられているか確認

### ❌ エラー 3: ログインボタンを押しても何も起こらない

**解決方法：**

- Firebase Console で Authentication > Sign-in method を確認
- Google が「有効」になっているか確認
- ブラウザのコンソール（F12 > Console）でエラーを確認

### ❌ エラー 4: Firestore 作成時に「請求（billing）を有効にする必要があります」と表示される

**解決方法：**
Firebase の無料プランでも請求情報の登録が必要な場合があります（**無料枠内なら実際に料金はかかりません**）。

**詳細な手順：**

- 📖 **`FIREBASE_BILLING_SETUP.md`** ファイルを開いて、詳しい手順を確認してください
- 簡単に言うと：
  1. エラーメッセージのリンクをクリック
  2. 請求先アカウントを作成
  3. クレジットカード情報を入力（無料枠内なら請求されません）
  4. **「無料プラン（Spark プラン）」を選択**（重要！）
  5. Firebase Console に戻って再度 Firestore を作成

**注意：**

- Firebase の無料枠（Spark プラン）は個人利用なら十分です（読み書き 5 万回/日、保存容量 1GB）
- 無料枠を超えなければ料金はかかりません

**請求情報を登録したくない場合：**

- 現在の機能（IndexedDB + 手動エクスポート/インポート）をそのまま使う
- または、Google Sheets / Notion へのバックアップ機能を使用する

### ❌ エラー 5: ログインはできるけどデータが保存されない

**解決方法：**

- Firebase Console で Firestore Database が作成されているか確認
- セキュリティルールが正しく設定されているか確認（ステップ 6-3 を参照）

---

## 💡 便利な機能

### 複数のデバイスで使う

- PC でログインして食材を登録
- スマホでも同じ Google アカウントでログイン
- データが自動的に同期されます！

### データが消えたら

- ブラウザのキャッシュを削除しても大丈夫
- Firebase にログインすれば、自動的にデータが復元されます

---

## 📞 まだわからないことがある？

設定で困ったら：

1. ブラウザのコンソール（F12 > Console）でエラーメッセージを確認
2. `FIREBASE_SETUP.md` の詳細版も参照してください
